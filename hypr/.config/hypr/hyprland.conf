# Hyprland Configuration
# Base config - shared across all machines
# Host-specific settings are sourced from ~/.config/hypr/host.conf

###################
### HOST CONFIG ###
###################

# Source host-specific config (monitor, scaling, hardware-specific env vars)
source = ~/.config/hypr/host.conf

###################
### MY PROGRAMS ###
###################

## Autostart
exec-once = $HOME/.config/hypr/start-waybar.sh
exec-once = swww-daemon && swww img /home/artur/.config/hypr/wallpaper.jpg
exec-once = hyprshot
exec-once = mako
exec-once = /usr/lib/hyprpolkitagent/hyprpolkitagent
exec-once = pypr
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store

#############################
### ENVIRONMENT VARIABLES ###
#############################

## Shared environment variables
env = XCURSOR_THEME,Bibata-Modern-Ice
env = HYPRCURSOR_THEME,Bibata-Modern-Ice

# Wayland basics
env = GDK_BACKEND,wayland
env = QT_QPA_PLATFORM,wayland
env = QT_QPA_PLATFORMTHEME,qt6ct
env = ELECTRON_OZONE_PLATFORM_HINT,wayland
env = MOZ_ENABLE_WAYLAND,1
env = MOZ_WEBRENDER,1

# XDG Portal configuration
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = GTK_USE_PORTAL,1

###################
### PERMISSIONS ###
###################

ecosystem {
    enforce_permissions = 1
}

permission = /home/artur/.local/bin/grim, screencopy, allow
permission = /usr/bin/grim, screencopy, allow
permission = /usr/lib/xdg-desktop-portal-hyprland, screencopy, allow
permission = /home/artur/.local/bin/hyprpm, plugin, allow
permission = /usr/bin/hyprpm, plugin, allow

###################
### GENERAL ###
###################

general {
    gaps_in = 1
    gaps_out = 1
    border_size = 1
    col.active_border = rgb(8A8A8D)
    col.inactive_border = rgb(282828)
    layout = dwindle
}

dwindle {
    pseudotile = false
    preserve_split = true
    smart_split = true
    smart_resizing = true
}

animations {
    enabled = false
}

misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
    disable_splash_rendering = true
    vfr = true
    vrr = 0
    enable_swallow = true
    focus_on_activate = true
    mouse_move_enables_dpms = true
    key_press_enables_dpms = true
}

input {
    kb_layout = us
    kb_variant = intl
    follow_mouse = 1
    sensitivity = 1.0
    accel_profile = flat
    force_no_accel = true
}

###################
### KEYBINDINGS ###
###################

$mainMod = SUPER

# Application shortcuts
bind = $mainMod, B, exec, chromium
bind = $mainMod, E, exec, wezterm start -- yazi
bind = $mainMod, F, fullscreen
bind = $mainMod, semicolon, togglesplit
bind = $mainMod, M, exec, rofi -show drun
bind = $mainMod SHIFT, M, exec, rofi -show run
bind = $mainMod, equal, exec, rofi -show calc -modi calc -no-show-match -no-sort
bind = $mainMod, period, exec, rofi -show emoji -modi emoji
bind = $mainMod, P, exec, hyprshot -m region
bind = $mainMod, Q, killactive
bind = $mainMod SHIFT, Q, forcekillactive
bind = $mainMod SHIFT, R, exec, /home/artur/.config/hypr/reload-hyprland.sh
bind = $mainMod, S, togglespecialworkspace, magic
bind = $mainMod SHIFT, S, movetoworkspace, special:magic
bind = $mainMod, V, togglefloating
bind = $mainMod, C, exec, codium
bind = $mainMod, T, exec, wezterm
bind = $mainMod, RETURN, exec, wezterm

# Focus movement (vim motions)
bind = $mainMod, h, movefocus, l
bind = $mainMod, l, movefocus, r
bind = $mainMod, k, movefocus, u
bind = $mainMod, j, movefocus, d
bind = $mainMod, tab, cyclenext

# Move windows (vim motions)
bind = $mainMod SHIFT, h, movewindow, l
bind = $mainMod SHIFT, l, movewindow, r
bind = $mainMod SHIFT, k, movewindow, u
bind = $mainMod SHIFT, j, movewindow, d

# Resize windows (vim motions) - 60px steps for 5K HiDPI
bind = $mainMod CTRL, h, resizeactive, -60 0
bind = $mainMod CTRL, l, resizeactive, 60 0
bind = $mainMod CTRL, k, resizeactive, 0 -60
bind = $mainMod CTRL, j, resizeactive, 0 60

# Preselect split direction (vim motions)
bind = $mainMod ALT, h, layoutmsg, preselect l
bind = $mainMod ALT, l, layoutmsg, preselect r
bind = $mainMod ALT, k, layoutmsg, preselect u
bind = $mainMod ALT, j, layoutmsg, preselect d

# Window operations (vim-style)
bind = $mainMod, u, focusurgentorlast
bind = $mainMod, space, layoutmsg, swapwithmaster

# Window groups (like vim tabs)
bind = $mainMod, g, togglegroup
bind = $mainMod ALT, n, changegroupactive, f
bind = $mainMod ALT, p, changegroupactive, b

# Workspaces
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Sequential workspace navigation (vim-style [ ] )
bind = $mainMod, bracketleft, workspace, e-1
bind = $mainMod, bracketright, workspace, e+1

# Move windows to workspaces
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Move window to adjacent workspace and follow
bind = $mainMod SHIFT, bracketleft, movetoworkspace, e-1
bind = $mainMod SHIFT, bracketright, movetoworkspace, e+1

# Volume controls
bindel = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
bindel = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindl = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindl = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle

# Music controls (MPD on svr-core)
bindl = , XF86AudioPlay, exec, MPD_HOST=192.168.178.102 mpc toggle
bindl = , XF86AudioNext, exec, MPD_HOST=192.168.178.102 mpc next
bindl = , XF86AudioPrev, exec, MPD_HOST=192.168.178.102 mpc prev
bindl = , XF86AudioStop, exec, MPD_HOST=192.168.178.102 mpc stop
# Scratchpads (pyprland)
bind = $mainMod, grave, exec, pypr toggle term
bind = $mainMod SHIFT, B, exec, pypr toggle btop
bind = $mainMod SHIFT, P, exec, pypr toggle music

# Clipboard history
bind = $mainMod SHIFT, V, exec, cliphist list | rofi -dmenu -p "Clipboard" | cliphist decode | wl-copy
bind = $mainMod SHIFT, D, exec, cliphist list | rofi -dmenu -p "Delete" | cliphist delete

# Lock screen
bind = $mainMod, Escape, exec, loginctl lock-session

# Notification DND toggle
bind = $mainMod, N, exec, makoctl mode -t dnd
bind = $mainMod SHIFT, N, exec, makoctl list | jq -r '.data[][] | "\(.["app-name"].data): \(.summary.data)"' | rofi -dmenu -p "Notifications"

# Mouse bindings
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

###################
### WINDOW RULES ###
###################

windowrule = float on, match:class ^(pavucontrol)$
windowrule = float on, match:class ^(blueman-manager)$
windowrule = float on, match:class ^(nm-connection-editor)$

# XWayland windows
windowrule = rounding 0, match:xwayland true


# Picture-in-picture
windowrule = float on, match:title ^(Picture-in-Picture)$
windowrule = pin on, match:title ^(Picture-in-Picture)$
windowrule = size 25% 25%, match:title ^(Picture-in-Picture)$
windowrule = move 73% 73%, match:title ^(Picture-in-Picture)$

# File dialogs
windowrule = float on, match:title ^(Open File)$
windowrule = float on, match:title ^(Save As)$
windowrule = float on, match:title ^(Open Folder)$
windowrule = size 80% 70%, match:title ^(Open File)$
windowrule = size 80% 70%, match:title ^(Save As)$
windowrule = center on, match:title ^(Open File)$
windowrule = center on, match:title ^(Save As)$

# Bitwarden popup
windowrule = float on, match:class ^(Bitwarden)$
windowrule = size 40% 80%, match:class ^(Bitwarden)$

###############################
### WORKSPACE ASSIGNMENTS ###
###############################

windowrule = workspace 2, match:class ^(chromium)$
windowrule = workspace 2, match:class ^(google-chrome)$
windowrule = workspace 2, match:class ^(zen)$
windowrule = workspace 3, match:class ^(codium)$
windowrule = workspace 4, match:class ^(Slack)$
windowrule = workspace 4, match:class ^(discord)$
windowrule = workspace 5, match:class ^(Spotify)$
windowrule = workspace 5, match:class ^(mpv)$

###########################
### GROUP/TAB STYLING ###
###########################

group {
    col.border_active = rgb(41c7b9)
    col.border_inactive = rgb(282828)
    col.border_locked_active = rgb(dbb32d)
    col.border_locked_inactive = rgb(282828)

    groupbar {
        font_family = JetBrainsMono Nerd Font
        font_size = 11
        height = 18
        col.active = rgb(41c7b9)
        col.inactive = rgb(2a2a2a)
        text_color = rgb(1c1c1c)
    }
}

decoration {
    shadow {
        enabled = false
    }
    blur {
        enabled = false
    }
}
